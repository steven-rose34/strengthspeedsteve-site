<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post | Strength Speed Steve</title>
  <link rel="stylesheet" href="style.css">
  <!-- External library for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <header>
    <h1><a href="index.html" style="color: white; text-decoration: none;">Strength Speed Steve</a></h1>
  </header>
  <main id="post-content">
    <!-- Post content will be injected here -->
  </main>
  <section id="comments">
    <h2>Comments</h2>
    <!-- Utterances comments will load here -->
  </section>
  <script>
    // Replace these placeholders with your GitHub username and repository name once the repo is created
    // Set your GitHub username and repository name
    const owner = 'steven-rose34';
    const repo = 'strengthspeedsteve-site';

    // Helper to get slug from query parameter
    function getSlug() {
      const params = new URLSearchParams(window.location.search);
      return params.get('slug');
    }

    /**
     * Simple parser for front matter in markdown files.
     * Extracts keyâ€‘value pairs between the first two '---' lines and
     * returns an object with `front` (metadata) and `body` (markdown body).
     */
    function parseFrontMatter(content) {
      const lines = content.split('\n');
      let front = {};
      if (lines[0].trim() === '---') {
        let i = 1;
        for (; i < lines.length; i++) {
          const line = lines[i].trim();
          if (line === '---') {
            i++;
            break;
          }
          const match = line.match(/^([^:]+):\s*(.*)$/);
          if (match) {
            const key = match[1].trim();
            let value = match[2].trim();
            // remove surrounding quotes if any
            if ((value.startsWith('"') && value.endsWith('"')) || (value.startsWith("'") && value.endsWith("'"))) {
              value = value.slice(1, -1);
            }
            front[key] = value;
          }
        }
        const body = lines.slice(i).join('\n');
        return { front, body };
      }
      return { front: {}, body: content };
    }

    // Load the post content based on slug
    async function loadPost() {
      const slug = getSlug();
      const contentElement = document.getElementById('post-content');
      if (!slug) {
        contentElement.innerHTML = '<p>No post specified.</p>';
        return;
      }
      try {
        const response = await fetch(`https://raw.githubusercontent.com/${owner}/${repo}/main/posts/${slug}.md`);
        if (!response.ok) throw new Error('Post not found');
        const raw = await response.text();
        const { front, body } = parseFrontMatter(raw);
        // Set page title
        document.title = `${front.title} | Strength Speed Steve`;
        // Convert markdown body to HTML
        const bodyHTML = marked.parse(body);
        // Render post
        contentElement.innerHTML = `
          <article>
            <h2>${front.title}</h2>
            <p><em>${new Date(front.date).toLocaleDateString()}</em></p>
            ${bodyHTML}
          </article>
        `;
        // Load comments for this post
        loadComments(slug);
      } catch (err) {
        console.error(err);
        contentElement.innerHTML = '<p>There was an error loading this post. Please check back later.</p>';
      }
    }

    // Load Utterances comments widget using slug as the issue term
    function loadComments(slug) {
      const commentsContainer = document.getElementById('comments');
      const script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.setAttribute('repo', `${owner}/${repo}`);
      script.setAttribute('issue-term', slug);
      script.setAttribute('label', 'comment');
      script.setAttribute('theme', 'github-light');
      script.crossOrigin = 'anonymous';
      script.async = true;
      commentsContainer.appendChild(script);
    }

    // Initialize
    loadPost();
  </script>
</body>
</html>